<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="base/layout">

<head>
    <title>数据整合</title>
    <link rel="stylesheet" href="/resources/plugins/zTree/zTreeStyle.css"/>
</head>
<body>
<div layout:fragment="content" >
    <!-- page content -->
    <div class="right_col" role="main">


        <div class="">
            <div class="page-title">
                <div class="title_left">
                    <h3>用户管理</h3>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="row">
                <ul id="navigationTree" class="ztree nav nav-pills nav-stacked"></ul>
            </div>
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="x_panel">
                        <div class="x_title">
                            <h2>增加菜单项</h2>

                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <br />
                            <form  data-parsley-validate class="form-horizontal form-label-left">

                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="parentName">父节点</label>
                                    <div class="col-md-6 col-sm-6 col-xs-12">
                                        <input type="text" id="parentName" name="parentName" required="required" class="form-control col-md-7 col-xs-12">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="menuName">名称</label>
                                    <div class="col-md-6 col-sm-6 col-xs-12">
                                        <input type="text" id="menuName" name="menuName" required="required" class="form-control col-md-7 col-xs-12">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="menuIndex" class="control-label col-md-3 col-sm-3 col-xs-12">顺序</label>
                                    <div class="col-md-6 col-sm-6 col-xs-12">
                                        <input id="menuIndex" name="menuIndex" class="date-picker form-control col-md-7 col-xs-12" required="required" type="text">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="iconClass" class="control-label col-md-3 col-sm-3 col-xs-12">图标</label>
                                    <div class="col-md-6 col-sm-6 col-xs-12">
                                        <input id="iconClass" name="iconClass" class="form-control col-md-7 col-xs-12" type="text" >
                                    </div>
                                </div>

                                <div class="ln_solid"></div>
                                <div class="form-group">
                                    <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">
                                        <button id="button_addMenu" class="btn btn-success">提交</button>
                                    </div>
                                </div>

                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /page content -->
</div>

</body>

<div layout:fragment="script">
    <script src="/resources/plugins/zTree/jquery.ztree.core-3.5.js"></script>
    <script type="text/javascript">

        //------zTree数据
        $(function () {
            $.fn.zTree.init($("#navigationTree"), setting);

            MessengerAjaxGet("/Navigation/getNavigationPageData", null, function(data){
                InitControllerActionListSelect(data);
            });
        });

        var setting = {
            view: {
                showIcon: showIconForTree,
                showLine: false
            },
            data: {
                key: {
                    name: "itemName"
                },
                simpleData: {
                    enable: true,
                    idKey: "guid",
                    pIdKey: "fatherGuid",
                    rootPId: 0
                }
            },
            async: {
                enable: true,
                url: "/menu/get",
                type: "get"
            },
            callback: {
                onAsyncSuccess: zTreeOnAsyncSuccess
            }
        };

        function showIconForTree(treeId, treeNode) {
            return !treeNode.isParent;
        }

        function zTreeOnAsyncSuccess(event, treeId, msg) {
            var zTree = $.fn.zTree.getZTreeObj(treeId);
            zTree.expandAll(true);

            var nodes = zTree.getNodes();
            InitNavigationListSelect(nodes);
        }

        function InitNavigationListSelect(navigationList) {
            $('#fatherGuid').empty();
            $('#fatherGuid').append("<option value=''></option>");
            for (var i = 0; i < navigationList.length; ++i) {
                $('#fatherGuid').append('<option value="' + navigationList[i].guid + '">' + navigationList[i].itemName + '</option>');
            }
        }

        function InitControllerActionListSelect(controllerActionList) {
            $('#urlGuid').empty();
            $('#urlGuid').append("<option value=''></option>");
            for (var j = 0; j < controllerActionList.length; ++j) {
                $('#urlGuid').append('<option value="' + controllerActionList[j].guid + '">' +
                        controllerActionList[j].url +
                        '(' + controllerActionList[j].description + ')'
                        + '</option>');
            }
        }


        $("#button_addMenu").click(function(){
            var parentName = $("#parentName").val();
            var menuName = $("#menuName").val();
            var menuIndex = $("#menuIndex").val();
            var iconClass = $("#iconClass").val();

            var menuVo = {parentName:parentName,
                menuName:menuName,
                menuIndex:menuIndex,
                iconClass:iconClass
            };//拼装成json格式

            $.ajax({
                type:"POST",
                url:"/addMenu",
                data:menuVo,
                success:function(){
                    alert("成功");
                },
                error:function(e) {
                    alert("出错："+e);
                }
            });
        });
    </script>

</div>
</html>